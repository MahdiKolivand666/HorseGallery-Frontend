# ๐ ุฑุงูููุง ฺฉุงูู API ุณุจุฏ ุฎุฑุฏ (Cart API) - Backend

## ๐ ููุฑุณุช ูุทุงูุจ

1. [ููุฏูู](#ููุฏูู)
2. [ุณุงุฎุชุงุฑ ุฏุงุฏูโูุง](#ุณุงุฎุชุงุฑ-ุฏุงุฏูโูุง)
3. [Endpoint ูุง ููุฑุฏ ูุงุฒ](#endpoint-ูุง-ููุฑุฏ-ูุงุฒ)
4. [ุฌุฒุงุช API ูุง](#ุฌุฒุงุช-api-ูุง)
5. [Authentication](#authentication)
6. [ุฎุทุงูุง ู Response ูุง](#ุฎุทุงูุง-ู-response-ูุง)
7. [ูฺฉุงุช ููู](#ูฺฉุงุช-ููู)

---

## ๐ฏ ููุฏูู

ุงู ูุณุชูุฏ ุชูุถุญ ูโุฏูุฏ ฺฉู ฺู API ูุง ุจุฑุง ูุฏุฑุช ุณุจุฏ ุฎุฑุฏ ุฏุฑ backend ูุงุฒ ุงุณุช ุชุง frontend ุจุชูุงูุฏ ุชูุงู ุนููุงุช ุณุจุฏ ุฎุฑุฏ ุฑุง ุงุฒ ุทุฑู backend ุงูุฌุงู ุฏูุฏ.

### โ ูุฒุงุง ุงูุชูุงู ุจู Backend:

- **ูุฏุฑุช State**: ุณุจุฏ ุฎุฑุฏ ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโุดูุฏ ู ุจุง refresh ุตูุญู ุงุฒ ุจู ููโุฑูุฏ
- **ุงููุช**: ูุญุงุณุจุงุช ุฏุฑ backend ุงูุฌุงู ูโุดูุฏ ู ูุงุจู ุฏุณุชฺฉุงุฑ ูุณุช
- **ููฺฏุงูโุณุงุฒ**: ุงฺฏุฑ ฺฉุงุฑุจุฑ ุฏุฑ ฺูุฏ ุฏุณุชฺฏุงู ุจุงุดุฏุ ุณุจุฏ ุฎุฑุฏ ููฺฏุงู ูโูุงูุฏ
- **ุชุงุฑุฎฺู**: ูโุชูุงู ุชุงุฑุฎฺู ุณุจุฏ ุฎุฑุฏ ุฑุง ูฺฏู ุฏุงุดุช

---

## ๐ ุณุงุฎุชุงุฑ ุฏุงุฏูโูุง

### 1. Cart Item (ุขุชู ุณุจุฏ ุฎุฑุฏ)

```typescript
interface CartItem {
  _id: string; // ID ุขุชู ุณุจุฏ ุฎุฑุฏ (ุงุฒ backend)
  productId: string; // ID ูุญุตูู (ุงุฒ ุฏุชุงุจุณ ูุญุตููุงุช)
  name: string; // ูุงู ูุญุตูู
  image: string; // URL ุนฺฉุณ ูุญุตูู
  price: number; // ููุช ููุง (ุจุง ุชุฎูู)
  originalPrice?: number; // ููุช ุงุตู (ุจุฏูู ุชุฎูู)
  quantity: number; // ุชุนุฏุงุฏ
  code: string; // ฺฉุฏ ูุญุตูู
  weight: string; // ูุฒู
  size?: string; // ุณุงุฒ (ุจุฑุง ุฌูุงูุฑุงุชุ ุงุฎุชุงุฑ)
  slug: string; // slug ูุญุตูู
  category: string; // slug ุฏุณุชูโุจูุฏ
  discount?: number; // ุฏุฑุตุฏ ุชุฎูู
  productType?: "jewelry" | "coin" | "melted_gold"; // ููุน ูุญุตูู
  goldInfo?: {
    // ุงุทูุงุนุงุช ุณฺฉู/ุดูุด (ุงุฎุชุงุฑ)
    weight?: number;
    purity?: string;
    certificate?: string;
    mintYear?: number;
    denomination?: string;
  };
  createdAt: string; // ุชุงุฑุฎ ุงุฌุงุฏ
  updatedAt: string; // ุชุงุฑุฎ ุจูโุฑูุฒุฑุณุงู
}
```

### 2. Cart (ุณุจุฏ ุฎุฑุฏ)

```typescript
interface Cart {
  _id: string; // ID ุณุจุฏ ุฎุฑุฏ
  userId?: string; // ID ฺฉุงุฑุจุฑ (ุงฺฏุฑ ูุงฺฏู ุจุงุดุฏ)
  sessionId?: string; // Session ID (ุงฺฏุฑ ูููุงู ุจุงุดุฏ)
  items: CartItem[]; // ูุณุช ุขุชูโูุง
  totalItems: number; // ุชุนุฏุงุฏ ฺฉู ุขุชูโูุง (ูุญุงุณุจู ุดุฏู)
  totalPrice: number; // ููุช ฺฉู (ูุญุงุณุจู ุดุฏู)
  createdAt: string;
  updatedAt: string;
}
```

### 3. Cart Summary (ุฎูุงุตู ุณุจุฏ)

```typescript
interface CartSummary {
  items: CartItem[];
  totalItems: number; // ูุฌููุน quantity ููู ุขุชูโูุง
  totalPrice: number; // ูุฌููุน (price * quantity) ููู ุขุชูโูุง
  itemCount: number; // ุชุนุฏุงุฏ ุขุชูโูุง ูุฎุชูู (length of items)
}
```

---

## ๐ Endpoint ูุง ููุฑุฏ ูุงุฒ

### Base URL

```
/api/cart
```

### Endpoint ูุง:

| Method   | Endpoint                  | ุชูุถุญุงุช                      |
| -------- | ------------------------- | ---------------------------- |
| `GET`    | `/api/cart`               | ุฏุฑุงูุช ุณุจุฏ ุฎุฑุฏ              |
| `POST`   | `/api/cart/items`         | ุงูุฒูุฏู ูุญุตูู ุจู ุณุจุฏ          |
| `PUT`    | `/api/cart/items/:itemId` | ุจูโุฑูุฒุฑุณุงู quantity ฺฉ ุขุชู |
| `DELETE` | `/api/cart/items/:itemId` | ุญุฐู ฺฉ ุขุชู ุงุฒ ุณุจุฏ           |
| `DELETE` | `/api/cart`               | ูพุงฺฉ ฺฉุฑุฏู ฺฉู ุณุจุฏ ุฎุฑุฏ         |

---

## ๐ ุฌุฒุงุช API ูุง

### 1๏ธโฃ ุฏุฑุงูุช ุณุจุฏ ุฎุฑุฏ

**GET** `/api/cart`

#### Request Headers:

```http
Authorization: Bearer <token>  // ุงฺฏุฑ ฺฉุงุฑุจุฑ ูุงฺฏู ุจุงุดุฏ (ุงุฎุชุงุฑ)
Cookie: sessionId=<sessionId>  // ุจุฑุง ูููุงู (ุงุฎุชุงุฑ)
```

#### Response (200 OK):

```json
{
  "success": true,
  "data": {
    "_id": "cart_123456",
    "userId": "user_789", // null ุงฺฏุฑ ูููุงู ุจุงุดุฏ
    "sessionId": "session_abc", // null ุงฺฏุฑ ูุงฺฏู ุจุงุดุฏ
    "items": [
      {
        "_id": "item_1",
        "productId": "product_123",
        "name": "ุฏุณุชุจูุฏ ุทูุง",
        "image": "/images/products/product1.webp",
        "price": 5000000,
        "originalPrice": 6000000,
        "quantity": 2,
        "code": "PRD-001",
        "weight": "10 ฺฏุฑู",
        "size": "16",
        "slug": "dastband-tala",
        "category": "women",
        "discount": 16,
        "productType": "jewelry",
        "createdAt": "2024-01-15T10:30:00Z",
        "updatedAt": "2024-01-15T11:00:00Z"
      }
    ],
    "totalItems": 2, // ูุฌููุน quantity
    "totalPrice": 10000000, // ูุฌููุน (price * quantity)
    "createdAt": "2024-01-15T10:00:00Z",
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

#### Response (404 - ุณุจุฏ ุฎุงู):

```json
{
  "success": true,
  "data": {
    "_id": "cart_123456",
    "items": [],
    "totalItems": 0,
    "totalPrice": 0
  }
}
```

---

### 2๏ธโฃ ุงูุฒูุฏู ูุญุตูู ุจู ุณุจุฏ

**POST** `/api/cart/items`

#### Request Body:

```json
{
  "productId": "product_123",
  "quantity": 1, // ุงุฎุชุงุฑุ ูพุดโูุฑุถ: 1
  "size": "16" // ุงุฎุชุงุฑ (ุจุฑุง ุฌูุงูุฑุงุช)
}
```

#### ููุทู Backend:

1. **ุจุฑุฑุณ ูุฌูุฏ ูุญุตูู**: ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูุญุตูู ุจุง `productId` ูุฌูุฏ ุฏุงุฑุฏ ู ููุฌูุฏ ุงุณุช
2. **ุจุฑุฑุณ ููุฌูุฏ**: ุจุฑุฑุณ ฺฉูุฏ ฺฉู `stock` ูุญุตูู ฺฉุงู ุงุณุช
3. **ุจุฑุฑุณ ุขุชู ููุฌูุฏ**:
   - ุจุฑุง **ุณฺฉู** (`productType === "coin"`): ููุท `productId` ุฑุง ฺฺฉ ฺฉูุฏ
   - ุจุฑุง **ุฌูุงูุฑุงุช** (`productType === "jewelry"`): `productId` + `size` ุฑุง ฺฺฉ ฺฉูุฏ
   - ุจุฑุง **ุดูุด** (`productType === "melted_gold"`): ููุท `productId` ุฑุง ฺฺฉ ฺฉูุฏ
4. **ุงูุฒูุฏู ุง ุจูโุฑูุฒุฑุณุงู**:
   - ุงฺฏุฑ ุขุชู ููุฌูุฏ ุจุงุดุฏ โ `quantity` ุฑุง ุงูุฒุงุด ุฏูุฏ (ูู ุงูฺฉู ุขุชู ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ)
   - ุงฺฏุฑ ุขุชู ููุฌูุฏ ูุจุงุดุฏ โ ุขุชู ุฌุฏุฏ ุจุง `quantity: 1` ุงุถุงูู ฺฉูุฏ
5. **ูุญุงุณุจู ููุช**: ุงุฒ ุฏุชุงุจุณ ูุญุตููุ ููุช ููุง (ุจุง ุชุฎูู) ุฑุง ุจฺฏุฑุฏ
6. **ูุญุงุณุจู totals**: `totalItems` ู `totalPrice` ุฑุง ุฏูุจุงุฑู ูุญุงุณุจู ฺฉูุฏ

#### Response (200 OK):

```json
{
  "success": true,
  "message": "ูุญุตูู ุจู ุณุจุฏ ุฎุฑุฏ ุงุถุงูู ุดุฏ",
  "data": {
    "_id": "item_1",
    "productId": "product_123",
    "name": "ุฏุณุชุจูุฏ ุทูุง",
    "image": "/images/products/product1.webp",
    "price": 5000000,
    "originalPrice": 6000000,
    "quantity": 2, // ุงฺฏุฑ ูุจูุงู 1 ุจูุฏุ ุญุงูุง 2 ุดุฏู
    "code": "PRD-001",
    "weight": "10 ฺฏุฑู",
    "size": "16",
    "slug": "dastband-tala",
    "category": "women",
    "discount": 16,
    "productType": "jewelry",
    "createdAt": "2024-01-15T10:30:00Z",
    "updatedAt": "2024-01-15T11:00:00Z"
  },
  "cart": {
    "totalItems": 2,
    "totalPrice": 10000000
  }
}
```

#### Response (400 - ุฎุทุง):

```json
{
  "success": false,
  "message": "ููุฌูุฏ ูุญุตูู ฺฉุงู ูุณุช",
  "error": "INSUFFICIENT_STOCK",
  "availableStock": 5
}
```

---

### 3๏ธโฃ ุจูโุฑูุฒุฑุณุงู ุชุนุฏุงุฏ ฺฉ ุขุชู

**PUT** `/api/cart/items/:itemId`

#### Request Body:

```json
{
  "quantity": 3
}
```

#### ููุทู Backend:

1. **ุจุฑุฑุณ ูุฌูุฏ ุขุชู**: ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุขุชู ุจุง `itemId` ุฏุฑ ุณุจุฏ ูุฌูุฏ ุฏุงุฑุฏ
2. **ุจุฑุฑุณ ููุฌูุฏ**: ุจุฑุฑุณ ฺฉูุฏ ฺฉู `stock` ูุญุตูู ฺฉุงู ุงุณุช
3. **ุจูโุฑูุฒุฑุณุงู**: `quantity` ุฑุง ุจู ููุฏุงุฑ ุฌุฏุฏ ุชุบุฑ ุฏูุฏ
4. **ุญุฐู ุฎูุฏฺฉุงุฑ**: ุงฺฏุฑ `quantity <= 0` ุจุงุดุฏุ ุขุชู ุฑุง ุญุฐู ฺฉูุฏ
5. **ูุญุงุณุจู totals**: `totalItems` ู `totalPrice` ุฑุง ุฏูุจุงุฑู ูุญุงุณุจู ฺฉูุฏ

#### Response (200 OK):

```json
{
  "success": true,
  "message": "ุชุนุฏุงุฏ ุจูโุฑูุฒุฑุณุงู ุดุฏ",
  "data": {
    "_id": "item_1",
    "quantity": 3,
    "updatedAt": "2024-01-15T11:15:00Z"
  },
  "cart": {
    "totalItems": 3,
    "totalPrice": 15000000
  }
}
```

---

### 4๏ธโฃ ุญุฐู ฺฉ ุขุชู ุงุฒ ุณุจุฏ

**DELETE** `/api/cart/items/:itemId`

#### Response (200 OK):

```json
{
  "success": true,
  "message": "ูุญุตูู ุงุฒ ุณุจุฏ ุฎุฑุฏ ุญุฐู ุดุฏ",
  "cart": {
    "totalItems": 1,
    "totalPrice": 5000000
  }
}
```

---

### 5๏ธโฃ ูพุงฺฉ ฺฉุฑุฏู ฺฉู ุณุจุฏ ุฎุฑุฏ

**DELETE** `/api/cart`

#### Response (200 OK):

```json
{
  "success": true,
  "message": "ุณุจุฏ ุฎุฑุฏ ูพุงฺฉ ุดุฏ",
  "data": {
    "items": [],
    "totalItems": 0,
    "totalPrice": 0
  }
}
```

---

## ๐ Authentication

### ุฏู ุญุงูุช:

#### 1. ฺฉุงุฑุจุฑ ูุงฺฏู ุดุฏู:

- ุงุฒ `userId` ุงุณุชูุงุฏู ฺฉูุฏ
- ุณุจุฏ ุฎุฑุฏ ุจู ุญุณุงุจ ฺฉุงุฑุจุฑ ูุชุตู ุงุณุช
- ุฏุฑ ฺูุฏ ุฏุณุชฺฏุงู ููฺฏุงู ูโูุงูุฏ

#### 2. ฺฉุงุฑุจุฑ ูููุงู (Guest):

- ุงุฒ `sessionId` ุงุณุชูุงุฏู ฺฉูุฏ (ุงุฒ Cookie ุง Header)
- ุณุจุฏ ุฎุฑุฏ ูููุช ุงุณุช
- ูโุชูุงูุฏ ุจุนุฏุงู ุจู ุญุณุงุจ ฺฉุงุฑุจุฑ ูุชุตู ฺฉูุฏ (merge cart)

### ูุซุงู Header:

```http
Authorization: Bearer <jwt_token>  // ุงฺฏุฑ ูุงฺฏู ุจุงุดุฏ
Cookie: sessionId=<session_id>     // ุงฺฏุฑ ูููุงู ุจุงุดุฏ
```

---

## โ๏ธ ุฎุทุงูุง ู Response ูุง

### ุฎุทุงูุง ุฑุงุฌ:

| ฺฉุฏ    | ูพุงู                 | ุชูุถุญุงุช                         |
| ----- | -------------------- | ------------------------------- |
| `400` | `INVALID_PRODUCT`    | ูุญุตูู ุงูุช ูุดุฏ                  |
| `400` | `INSUFFICIENT_STOCK` | ููุฌูุฏ ฺฉุงู ูุณุช                |
| `400` | `INVALID_QUANTITY`   | ุชุนุฏุงุฏ ูุงูุนุชุจุฑ ุงุณุช               |
| `400` | `INVALID_SIZE`       | ุณุงุฒ ูุงูุนุชุจุฑ ุงุณุช (ุจุฑุง ุฌูุงูุฑุงุช) |
| `404` | `CART_NOT_FOUND`     | ุณุจุฏ ุฎุฑุฏ ุงูุช ูุดุฏ               |
| `404` | `ITEM_NOT_FOUND`     | ุขุชู ุฏุฑ ุณุจุฏ ุงูุช ูุดุฏ            |
| `401` | `UNAUTHORIZED`       | ูุงุฒ ุจู ุงุญุฑุงุฒ ููุช              |

### ูุฑูุช ุฎุทุง:

```json
{
  "success": false,
  "message": "ูพุงู ุฎุทุง ุจู ูุงุฑุณ",
  "error": "ERROR_CODE",
  "details": {} // ุงุฎุชุงุฑ
}
```

---

## ๐ก ูฺฉุงุช ููู

### 1. ูุญุงุณุจู ููุช:

- ููุดู ููุช ููุง (ุจุง ุชุฎูู) ุฑุง ุงุฒ ุฏุชุงุจุณ ูุญุตูู ุจฺฏุฑุฏ
- ุงฺฏุฑ ูุญุตูู ุชุฎูู ุฏุงุฑุฏุ `discountPrice` ุฑุง ุงุณุชูุงุฏู ฺฉูุฏ
- `originalPrice` ุฑุง ูู ุฐุฎุฑู ฺฉูุฏ ุจุฑุง ููุงุด

### 2. ููุทู ุงูุฒูุฏู:

- **ููู**: ุงฺฏุฑ ูุญุตูู ูุจูุงู ุฏุฑ ุณุจุฏ ุจุงุดุฏุ `quantity` ุฑุง ุงูุฒุงุด ุฏูุฏ (ูู ุงูฺฉู ุขุชู ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ)
- ุจุฑุง ุณฺฉู: ููุท `productId` ุฑุง ฺฺฉ ฺฉูุฏ
- ุจุฑุง ุฌูุงูุฑุงุช: `productId` + `size` ุฑุง ฺฺฉ ฺฉูุฏ

### 3. ุจุฑุฑุณ ููุฌูุฏ:

- ูุจู ุงุฒ ุงูุฒูุฏู/ุจูโุฑูุฒุฑุณุงูุ `stock` ูุญุตูู ุฑุง ฺฺฉ ฺฉูุฏ
- ุงฺฏุฑ `quantity` ุจุดุชุฑ ุงุฒ `stock` ุจุงุดุฏุ ุฎุทุง ุจุฑฺฏุฑุฏุงูุฏ

### 4. ูุญุงุณุจู Totals:

- `totalItems`: ูุฌููุน `quantity` ููู ุขุชูโูุง
- `totalPrice`: ูุฌููุน `(price * quantity)` ููู ุขุชูโูุง
- ุจุนุฏ ุงุฒ ูุฑ ุชุบุฑุ ุงู ููุงุฏุฑ ุฑุง ุฏูุจุงุฑู ูุญุงุณุจู ฺฉูุฏ

### 5. Session Management:

- ุจุฑุง ูููุงูโูุงุ `sessionId` ุฑุง ุฏุฑ Cookie ุฐุฎุฑู ฺฉูุฏ
- ุงฺฏุฑ ฺฉุงุฑุจุฑ ูุงฺฏู ฺฉุฑุฏุ ุณุจุฏ ูููุงู ุฑุง ุจู ุญุณุงุจ ฺฉุงุฑุจุฑ merge ฺฉูุฏ

### 6. Performance:

- ูโุชูุงูุฏ `totalItems` ู `totalPrice` ุฑุง ุฏุฑ ุฏุชุงุจุณ cache ฺฉูุฏ
- ุงูุง ุจุนุฏ ุงุฒ ูุฑ ุชุบุฑุ ุญุชูุงู ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ

---

## ๐ ูุซุงู ฺฉุงูู Request/Response

### ุงูุฒูุฏู ูุญุตูู (ุณฺฉู):

```http
POST /api/cart/items
Content-Type: application/json
Cookie: sessionId=abc123

{
  "productId": "coin_001",
  "quantity": 1
}
```

```json
{
  "success": true,
  "message": "ูุญุตูู ุจู ุณุจุฏ ุฎุฑุฏ ุงุถุงูู ุดุฏ",
  "data": {
    "_id": "item_coin_001",
    "productId": "coin_001",
    "name": "ุณฺฉู ุชูุงู ุจูุงุฑ ุขุฒุงุฏ",
    "image": "/images/products/coinphoto.webp",
    "price": 15000000,
    "quantity": 1,
    "code": "COIN-001",
    "weight": "8.13 ฺฏุฑู",
    "slug": "seke-tamam-bahar-azadi",
    "category": "coin",
    "productType": "coin",
    "goldInfo": {
      "weight": 8.13,
      "purity": "900",
      "denomination": "ุชูุงู"
    }
  },
  "cart": {
    "totalItems": 1,
    "totalPrice": 15000000
  }
}
```

---

## โ ฺฺฉโูุณุช ูพุงุฏูโุณุงุฒ

- [ ] ูุฏู Cart ู CartItem ุฏุฑ ุฏุชุงุจุณ
- [ ] Endpoint ุฏุฑุงูุช ุณุจุฏ ุฎุฑุฏ
- [ ] Endpoint ุงูุฒูุฏู ูุญุตูู (ุจุง ููุทู ุงูุฒุงุด quantity)
- [ ] Endpoint ุจูโุฑูุฒุฑุณุงู quantity
- [ ] Endpoint ุญุฐู ุขุชู
- [ ] Endpoint ูพุงฺฉ ฺฉุฑุฏู ุณุจุฏ
- [ ] ุจุฑุฑุณ ููุฌูุฏ ูุญุตูู
- [ ] ูุญุงุณุจู totals
- [ ] ูุฏุฑุช Session (ูููุงู)
- [ ] ูุฏุฑุช User (ูุงฺฏู)
- [ ] Merge cart (ููุช ฺฉุงุฑุจุฑ ูุงฺฏู ูโฺฉูุฏ)
- [ ] Validation (productId, quantity, size)
- [ ] Error handling

---

**ุชุงุฑุฎ ุงุฌุงุฏ**: 2024-01-15  
**ูุณุฎู**: 1.0.0
